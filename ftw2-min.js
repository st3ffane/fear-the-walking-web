(function(window,factory){if(typeof define==="function"&&define.amd){define(factory)}else{if(typeof exports==="object"){module.exports=factory()}else{window["FTW2"]=new (factory())()}}}(this,function(){var CONTEXT=null;var BINDINGS=[];var MODELS={};var __uuid_date=null;function generateUUID(){__uuid_date=new Date().getTime();var uuid="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,__replace_uuid);return uuid}function __replace_uuid(c){var d=__uuid_date;var r=(d+Math.random()*16)%16|0;d=Math.floor(d/16);return(c=="x"?r:(r&3|8)).toString(16)}function getDomPath(elem,root){var el=elem;if(!el){return}var stack=[];while(el!=root&&el.parentNode!=null){if(el.hasAttribute("id")&&el.id!=""){stack.unshift(el.nodeName.toLowerCase()+"#"+el.id)}else{var sibCount=0;var sibIndex=0;var nodeName=el.nodeName;for(var i=0;i<el.parentNode.childNodes.length;i++){var sib=el.parentNode.childNodes[i];if(sib.nodeName==nodeName){if(sib===el){sibIndex=sibCount;break}sibCount++}}if(sibIndex>0){stack.unshift(nodeName+":nth-of-type("+(sibIndex+1)+")")}else{stack.unshift(nodeName)}}el=el.parentNode}return stack.join(" > ")}function check_radio_value(value,params){return value?value==params:null}var DBArray=Object.create(Array);DBArray.push=function(){Array.prototype.push.apply(this,arguments);if(this.__owners__){var extra={action:"PUSH",value:arguments.length};for(owi=0;owi<this.__owners__.length;owi++){ow=this.__owners__[owi];if(ow[0].notifyDatasetChanged){ow[0].notifyDatasetChanged(ow[1],extra)}}}};DBArray.splice=function(){Array.prototype.splice.apply(this,arguments);extra={action:"SPLICE",index:arguments[0],howmany:arguments[1],count:arguments.length-2};if(this.__owners__){for(owi=0;owi<this.__owners__.length;owi++){ow=this.__owners__[owi];if(ow[0].notifyDatasetChanged){ow[0].notifyDatasetChanged(ow[1],extra)}}}};DBArray.pop=function(){var p=Array.prototype.pop(this,arguments);if(this.__owners__){var extra={action:"POP"};for(owi=0;owi<this.__owners__.length;owi++){ow=this.__owners__[owi];if(ow[0].notifyDatasetChanged){ow[0].notifyDatasetChanged(ow[1],extra)}}}return p};DBArray.shift=function(){p=Array.prototype.shift.apply(this,arguments);extra={action:"SHIFT"};if(this.__owners__){for(owi=0;owi<this.__owners__.length;owi++){ow=this.__owners__[owi];if(ow[0].notifyDatasetChanged){ow[0].notifyDatasetChanged(ow[1],extra)}}}return p};DBArray.unshift=function(){p=Array.prototype.unshift.apply(this,arguments);extra={action:"UNSHIFT",value:arguments.length};if(this.__owners__){for(owi=0;owi<this.__owners__.length;owi++){ow=this.__owners__[owi];if(ow[0].notifyDatasetChanged){ow[0].notifyDatasetChanged(ow[1],extra)}}}return p};DBArray.set=function(obj,index){old=this[index].__uuid__;this[index]=obj;extra={action:"SET",index:index};if(this.__owners__){for(owi=0;owi<this.__owners__.length;owi++){ow=this.__owners__[owi];if(ow[0].notifyDatasetChanged){ow[0].notifyDatasetChanged(ow[1],extra)}}}};Object._defineProperty=Object.defineProperty;Object.defineProperty=function(cible,name,accessors){if(accessors.set){setters={get:function(){return accessors.get.call(this)},set:function(v){accessors.set.call(this,v);if(this.__uuid__){var key=this.__uuid__+":"+name;var bindings=BINDINGS;if(key in bindings){__notifyDatasetChanged(this,bindings[key],key)}}}};Object._defineProperty(cible,name,setters)}else{Object._defineProperty(cible,name,accessors)}};var defineBindObject=function(obj){if(obj==null){return}var is_array=false;if(obj.hasOwnProperty("__uuid__")!==true){if(Array.isArray(obj)&&""+Object.prototype.toString.call(obj)!="[object String]"){is_array=true}else{if(""+Object.prototype.toString.call(obj)!="[object Object]"){return}}}else{return}var uuid=generateUUID();Object.defineProperty(obj,"__uuid__",{value:uuid,enumerable:false,writable:false});Object.defineProperty(obj,"notifyDatasetChanged",{value:function(name,extra){var key=this.__uuid__+":"+name;if(key in BINDINGS){__notifyDatasetChanged(this,BINDINGS[key],key,extra)}},enumerable:false,writable:false});Object.defineProperty(obj,"__owners__",{value:[],enumerable:false,modifiable:true});obj.AddToOwners=function(owner,prop_name){this.__owners__.push([owner,prop_name])};obj.RemoveFormOwners=function(owner,prop_name){if(this.__owners__){var owi=this.__owners__.length;while(owi--){var ow=this.__owners__[owi];if(ow[0]==owner&&ow[1]==prop_name){this.__owners__.slice(owi,1);break}}}};if(is_array){obj.__proto__=DBArray;return}else{for(obj_k in obj){if(typeof obj[obj_k]=="function"||obj_k.substr(0,1)=="_"){continue}var old=obj[obj_k];Object.defineProperty(obj,"__"+obj_k,{value:obj[obj_k],enumerable:false,writable:true});__define_property(obj,obj_k);if(obj[obj_k]!=undefined){defineBindObject(obj[obj_k]);if(obj[obj_k]!=undefined&&obj[obj_k].AddToOwners){obj[obj_k].AddToOwners(obj,obj_k)}}}}};function __define_property(obj,obj_k){Object.defineProperty(obj,obj_k,{get:function(){return this["__"+obj_k]},set:function(value){var old=this["__"+obj_k];if(value!=null){defineBindObject(value)}if(old!=null&&old.RemoveFromOwners){old.RemoveFromOwners(this,obj_k)}if(value!=null&&value.AddToOwners){value.AddToOwners(this,obj_k)}this["__"+obj_k]=value}})}HTMLElement.prototype._addEventListener=HTMLElement.prototype.addEventListener;HTMLElement.prototype.addEventListener=function(a,b){this._addEventListener(a,b);if(!this.eventListenerList){this.eventListenerList={}}if(!this.eventListenerList[a]){this.eventListenerList[a]=[]}this.eventListenerList[a].push(b)};HTMLElement.prototype._removeChild=HTMLElement.prototype.removeChild;HTMLElement.prototype.removeChild=function(child){this._removeChild(child);clear_events(child)};function clear_events(child){if(child.eventListenerList){var events=null;var j=0;for(key in child.eventListenerList){events=child.eventListenerList[key];j=events.length;while(j--){child.removeEventListener(key,events[j]);if(child._input_binding){child._input_binding=null}if(child._cmd_binding){child._cmd_binding=null}}}}if(child.children){var elem=null;var ci=child.children.length;while(ci--){elem=child.children[ci];clear_events(elem)}}}function __prop_binding(infos){if(infos==null){return}this._path=infos.path;this.to=infos.to;this.from=infos.from;this.mode=infos.mode;this.converter=infos.converter;this._converter_params=null;this._fallback=null;this.converter_params=infos.converter_params;this.fallback=infos.fallback;this.alt=infos.alt;this.root=infos.root;this._element=infos._element;this._key_uuid_=null}__prop_binding.prototype={get converter_params(){return this._converter_params},set converter_params(value){if(value==null){this._converter_params=null}else{if(value[0]=="["&&value[value.length-1]=="]"){value=value.substring(1,value.length-1);this._converter_params=[];vs=value.split(",");for(vp=0;vp<vs.length;vp++){p=vs[vp];this._converter_params.push(__unstringify(p))}}else{this._converter_params=__unstringify(value)}}},get fallback(){return this._fallback},set fallback(value){this._fallback=__unstringify(value)}};__prop_binding.prototype.init=function(context){};__prop_binding.prototype.getBindingKeys=function(infos){var infos=infos||this;var keys=infos.alt;if(keys){keys=keys.split(",")}else{keys=[]}if(this.converter_params!=null){var ci=this.converter_params.length;var p=null;while(ci--){p=this.converter_params[ci];if(p[0]=="$"){p=p.substring(1);keys.push(p)}}}keys.push(infos.from);return keys};__prop_binding.prototype.populate=function(value,context,extra){if(value==null){value=this.fallback}value=this.convert_value(value,context);this._element[this.to]=value;this._key_uuid_=context.__uuid__+":"+this.from};__prop_binding.prototype.convert_value=function(value,context){if(this.converter!=null){var p=null;var cp=null,key=null,keys=null,v=null;if(this.converter_params!=null){if(Array.isArray(this.converter_params)){p=[];var cpi=this.converter_params.length;while(cpi--){cp=this.converter_params[cpi];if(cp[0]=="$"){key=cp.slice(1);v=context;keys=key.split(".");if(keys[0]=="global"){v=CONTEXT;keys=keys.slice(1)}for(var k=0,e=keys.length;k<e;k++){k=keys[k];if(k in v){v=v[k]}else{v=null;break}}p.push(v)}else{p.push(cp)}}}else{cp=this.converter_params;if(cp[0]=="$"){key=cp.slice(1);if(key in context){p=context[key]}}else{p=cp}}}if(this.converter.startsWith("ftw2:")){converter=this.converter.substr(5);value=eval(converter)(value,p)}else{value=window[this.converter](value,p)}}return value};__prop_binding.prototype.clone=function(root){infos={};for(k in this._infos){infos[k]=this._infos[k]}infos["process_event"]=true;infos._element=root.querySelector(this._path);return __create_binding_from_infos(infos)};function __textContent_binding(infos){__prop_binding.call(this,infos);this._index=infos._index;this._length=infos._length}__textContent_binding.prototype=new __prop_binding();__textContent_binding.prototype.populate=function(value,context,extra){if(value==null){value=this.fallback}value=""+this.convert_value(value,context);var dt=this._element.textContent;var start=this._index==0?"":dt.substring(0,this._index);var end=dt.substring(this._index+this._length);this._length=value.length;this._element.textContent=start+value+end;this._key_uuid_=context.__uuid__+":"+this.from};function __attr_binding(infos){__prop_binding.call(this,infos);this._index=infos._index;this._length=infos._length}__attr_binding.prototype=new __prop_binding();__attr_binding.prototype.populate=function(value,context,extra){if(value==null){value=this.fallback}value=""+this.convert_value(value,context);var dt=this._element.getAttribute("data-binded-"+this.to);if(dt==null){dt=this._element.getAttribute(this.to)}var start=this._index==0?"":dt.substring(0,this._index);var end=dt.substring(this._index+this._length);this._element.setAttribute(this.to,start+value+end);this._key_uuid_=context.__uuid__+":"+this.from};function __model_binding(infos){if(infos==null){return}this.deep=infos.deep;__prop_binding.call(this,infos);this.presenter=infos.presenter;this.merge=infos.merge;this.empty=infos.empty;model=document.getElementById(this.presenter);if(model){this._root_model=model;this._cache_types={};var children=model.children;if(children==null){children=[];var childs=model.childNodes;var end=childs.length;for(i=0;i<end;i++){if(childs[i].nodeType!=8&&(childs[i].nodeType!=3||/\S/.test(childs[i].nodeValue))){children.push(childs[i]);break}}}var count=children.length;while(count--){var elem=children[count];var type="defaut";if(elem.hasAttribute("data-type")){type=elem.getAttribute("data-type")}this._cache_types[type]=elem}if(this.fallback){this._cache_types["fallback"]=document.getElementById(this.fallback)}if(this.empty){this._cache_types["empty"]=document.getElementById(this.empty)}}}__model_binding.prototype=new __prop_binding();__model_binding.prototype._clean=function(root){var old_type="defaut";if(root.firstChild!=null){var current_keys=root.firstChild._ftw2_keys;if(current_keys){var model_bindings=[];var current=null,cr=null,index=0,test=null;for(var key in current_keys){current=current_keys[key];var bi=current.length;while(current--){cr=current[bi];if(cr.context){cr.context=null}index=BINDINGS[key].indexOf(cr);test=BINDINGS[key].splice(index,1)[0];model_bindings.push(test);if(BINDINGS[key].length==0){delete (BINDINGS[key])}}}this._current_keys={}}root.removeChild(root.firstChild)}};__model_binding.prototype._process_fallback=function(){if(this.fallback==null){var p_type=this.presenter;var presenter_type=p_type+"_fallback";if(presenter_type in MODELS){return this._populate_model(CONTEXT,p_type,"fallback",false)}}else{if(this._cache_fallback){return this._populate_model(CONTEXT,this.fallback,"fallback",false)}}};__model_binding.prototype._populate_model=function(context,mroot,type,deep){defineBindObject(context);var model=null;var bindings=null;var item_type=type||context.constructor.name||"defaut";var p_type=mroot||this.presenter||this.item_presenter;var frag=null;var current_keys=[];var deep_binding=deep||this.deep||true;var bindings=null;var model=null;var proto=context;var item_type="";if(type=="fallback"){bindings=MODELS[p_type+"_fallback"];model=this._cache_types["fallback"]}else{if(type=="empty"){bindings=MODELS[p_type+"_empty"];model=this._cache_types["empty"]}else{while(proto!=null){var presenter_type=p_type+"_"+proto.constructor.name;if(presenter_type in MODELS){var item_type=proto.constructor.name;bindings=MODELS[presenter_type];model=this._cache_types[item_type];break}proto=proto.__proto__}}}if(model==null){item_type="defaut";bindings=MODELS[p_type];model=this._cache_types["defaut"]}if(model==null){this._element[this.to]=" unknown model! "+context;return}var cpy_model=model.cloneNode(true);cpy_model._ftw2_type=item_type;frag=cpy_model;for(var key in bindings){var bd=[];var h=bindings[key].length;while(h--){var infos={};var inf=bindings[key][h];for(var k in inf){infos[k]=inf[k]}infos["process_event"]=true;infos._element=cpy_model;if(infos.path){infos._element=cpy_model.querySelector(infos.path)}var clone=__create_binding_from_infos(infos);if(context.__uuid__&&deep_binding===true){var keys=this.getBindingKeys(infos);var kk=keys.length;while(kk--){var n_key=keys[kk];var g_key=context.__uuid__+":"+n_key;if(g_key in BINDINGS){BINDINGS[g_key].push(clone)}else{BINDINGS[g_key]=[clone]}if(g_key in current_keys){current_keys[g_key].push(clone)}else{current_keys[g_key]=[clone]}}}bd.push(clone);clone.init(context)}__notifyDatasetChanged(context,bd,key)}frag._ftw2_keys=current_keys;return frag};__model_binding.prototype.populate=function(context,parent,extra){var fragment=document.createDocumentFragment();var sibling=this._element.nextSibling;var parent=this._element.parentNode;var frag=this._element;var context=this.convert_value(context,parent);this._clean(frag);if(context==null){frag.appendChild(this._process_fallback())}else{frag.appendChild(this._populate_model(context))}if(sibling){parent.insertBefore(frag,sibling)}else{parent.appendChild(frag)}};function __array_binding(infos){__model_binding.call(this,infos);this.presenter=infos.item_presenter;this._empty=false;this.merge=infos.merge;var model=document.getElementById(this.presenter);if(model){this._root_model=model;this._cache_types={};var children=model.children;if(children==null){children=[];var childs=model.childNodes;var end=childs.length;for(i=0;i<end;i++){if(childs[i].nodeType!=8&&(childs[i].nodeType!=3||/\S/.test(childs[i].nodeValue))){children.push(childs[i]);break}}}var count=children.length;while(count--){var elem=children[count];var type="defaut";if(elem.hasAttribute("data-type")){type=elem.getAttribute("data-type")}this._cache_types[type]=elem}if(this.fallback){this._cache_types["fallback"]=document.getElementById(this.fallback)}if(this.empty){this._cache_types["empty"]=document.getElementById(this.empty)}}}__array_binding.prototype=new __model_binding();__array_binding.prototype._clear_binding=function(bindings){for(key in bindings){__notifyDatasetChanged(null,bindings[key],key)}};__array_binding.prototype._clean_child=function(child,root){if(child!=null){var current_keys=child._ftw2_keys;if(current_keys){var model_bindings=[];for(var key in current_keys){current=current_keys[key];for(bi=0;bi<current.length;bi++){cr=current[bi];index=BINDINGS[key].indexOf(cr);test=BINDINGS[key].splice(index,1)[0];model_bindings.push(test);if(BINDINGS[key].length==0){delete (BINDINGS[key])}}}}root.removeChild(child)}};__array_binding.prototype.populate=function(value,context,extra){var fragment=document.createDocumentFragment();var sibling=this._element.nextSibling;var parent=this._element.parentNode;var frag=this._element;fragment.appendChild(frag);if(frag.firstChild&&frag.firstChild.nodeType===3){frag.removeChild(frag.firstChild)}var value=this.convert_value(value,context);if(value==null){this._empty=true;while(frag.firstChild){frag.removeChild(frag.firstChild)}if(this.fallback){frag.appendChild(this._populate_model(CONTEXT,this.fallback,"fallback",false))}if(sibling){parent.insertBefore(frag,sibling)}else{parent.appendChild(frag)}return}if(value.length==0){this._empty=true;while(frag.firstChild){frag.removeChild(frag.firstChild)}if(this.empty){frag.appendChild(this._populate_model(CONTEXT,this.empty,"empty",false))}if(sibling){parent.insertBefore(frag,sibling)}else{parent.appendChild(frag)}return}if(this._empty){while(frag.firstChild){frag.removeChild(frag.firstChild)}this._empty=false}if(extra!=null){switch(extra.action){case"SET":var ci=extra.index;this._clean_child(frag.children[ci],frag);var item=value[ci];var result=this._populate_item(item);result.__uuid__=item.__uuid__;var prec=ci==0?frag.firstChild:frag.children[ci-1];frag.insertBefore(result,prec);if(sibling){parent.insertBefore(frag,sibling)}else{parent.appendChild(frag)}return;case"POP":this._clean_child(frag.children[frag.children.length-1],frag);if(sibling){parent.insertBefore(frag,sibling)}else{parent.appendChild(frag)}return;case"PUSH":var count=extra.value;var add_childs=[];var first=value.length-count;for(var c=value.length-1;c>=first;c--){add_childs.push(value[c])}for(var ci=0;ci<add_childs.length;ci++){var item=add_childs[ci];var result=this._populate_item(item);result.__uuid__=item.__uuid__;frag.appendChild(result)}if(sibling){parent.insertBefore(frag,sibling)}else{parent.appendChild(frag)}return;case"SHIFT":this._clean_child(frag.children[0],frag);if(sibling){parent.insertBefore(frag,sibling)}else{parent.appendChild(frag)}return;case"UNSHIFT":var count=extra.value;var add_childs=[];for(var c=count-1;c>=0;c--){add_childs.push(value[c])}for(var ci=0;ci<add_childs.length;ci++){var item=add_childs[ci];var result=this._populate_item(item);result.__uuid__=item.__uuid__;frag.insertBefore(result,frag.firstChild)}if(sibling){parent.insertBefore(frag,sibling)}else{parent.appendChild(frag)}return;case"SPLICE":var index=extra.index;var howmany=extra.howmany;var count=extra.count;for(var ci=index;ci<index+howmany;ci++){this._clean_child(frag.children[ci],frag)}if(count!=undefined&&count>0){var add_childs=[];var prec=frag.children[index];for(var c=count-1;c>=0;c--){add_childs.push(value[index+c])}for(var ci=0;ci<add_childs.length;ci++){var item=add_childs[ci];var result=this._populate_item(item);result.__uuid__=item.__uuid__;frag.insertBefore(result,prec)}}if(sibling){parent.insertBefore(frag,sibling)}else{parent.appendChild(frag)}return;default:break}}var removeChilds=frag.children;if(removeChilds==null){removeChilds=[];var childs=frag.childNodes;var end=childs.length;for(i=0;i<end;i++){if(childs[i].nodeType!=8&&(childs[i].nodeType!=3||/\S/.test(childs[i].nodeValue))){removeChilds.push(childs[i])}}}for(var ci=removeChilds.length-1;ci>=0;ci--){this._clean_child(removeChilds[ci],frag)}for(var ci=0;ci<value.length;ci++){var item=value[ci];var result=this._populate_item(item);frag.appendChild(result)}this._key_uuid_=context.__uuid__+":"+this.from;if(sibling){parent.insertBefore(frag,sibling)}else{parent.appendChild(frag)}};__array_binding.prototype._populate_item=function(context,parent,extra){if(context==null){return this._process_fallback()}var child=this._populate_model(context);this._key_uuid_=context.__uuid__+":"+this.from;return child};function __array_insert_order(arr,item,o_b){for(li=0;li<arr.length;li++){pitem=arr[li];if(item[o_b]<pitem[o_b]){arr.splice(li,0,item);return}}arr.push(item)}function __command_binding(infos){__prop_binding.call(this,infos);infos.from=this.from="COMMANDS";this.context=null;this.command=infos.command;this._cmd_parameters=null;this.command_params=infos.command_params;var bind=this}var cb_pr={get command_params(){return this._cmd_parameters},set command_params(value){if(value==null){this._cmd_parameters=null}else{if(value[0]=="["&&value[value.length-1]=="]"){value=value.substring(1,value.length-2);this._cmd_parameters=[];var cmds=value.split(",");var cmd_length=cmds.length;for(var p=0;p<cmd_length;p++){this._cmd_parameters.push(cmds[p])}}else{this._cmd_parameters=[value]}}}};cb_pr.__proto__=new __prop_binding();__command_binding.prototype=cb_pr;__command_binding.prototype.init=function(ctx){this.context=ctx;if(this.command!=null&&this.to!=null){this._element.addEventListener(this.to,this.__process_event);this._element._cmd_binding=this}};__command_binding.prototype.populate=function(value,context,extra){this.init(context)};__command_binding.prototype.__process_event=function(evt){bind=this._cmd_binding;if(bind==null||bind.context==null){return}value=bind.command;if(value==null){value=bind.fallback}value=bind.convert_value(value,bind.context);params=null;if(bind.command_params!=null){params=[];for(cpi=0;cpi<bind.command_params.length;cpi++){if(bind.command_params[cpi][0]=="$"){prop=bind.command_params[cpi].substr(1);if(prop in bind.context){params.push(bind.context[prop])}else{params.push("null")}}else{params.push(bind.command_params[cpi])}}}CONTEXT[value](evt,params)};function __input_binding(infos){__prop_binding.call(this,infos);this._pass=false;this.return_value=infos.return_value;this._event=infos.event==null?"change":infos.event;if(infos.process_event){this.init(CONTEXT)}}__input_binding.prototype=new __prop_binding();__input_binding.prototype.init=function(context){this._element.addEventListener(this._event,this.on_process_event);this.context=context;this._element._input_binding=this};__input_binding.prototype.on_process_event=function(evt){bind=this._input_binding;if(bind==null||bind.context==null){return}value=bind.return_value===true?this.value:this[bind.to];if(value==null||value==undefined||value==""){this.placeholder=bind.fallback}try{bind.mirror(value);this.setCustomValidity("")}catch(err){this.setCustomValidity(err.message);if(this.form){if(this.form.reportValidity){window.setTimeout(function(){bind._element.form.reportValidity();var value=bind.convert_value(bind.context[bind.from],bind.context);if(value===null||value===undefined||value===""){bind._element.placeholder=this.fallback;return}bind._element[bind.to]=value;window.setTimeout(function(){bind._element.setCustomValidity("")},2000)})}else{form=bind._element.form;for(i=form.length-1;i>=0;i--){var input=form[i];if(input.getAttribute("type")=="submit"){window.setTimeout(function(){input.click();value=bind.convert_value(bind.context[bind.from],bind.context);if(value===null||value===undefined||value===""){bind._element.placeholder=this.fallback;bind._element.value="";return}bind._element[bind.to]=value;window.setTimeout(function(){bind._element.setCustomValidity("")},2000)},20);return}}}}}};__input_binding.prototype.mirror=function(value){this._pass=true;ctx=this.context==null?CONTEXT:this.context;ctx[this.from]=value;this._pass=false};__input_binding.prototype.clean=function(){infos._element.removeEventListener(this._event,this.on_process_event)};__input_binding.prototype.populate=function(value,context,extra){if(this._pass){return}value=this.convert_value(value,context);if(value===null||value===undefined||value===""){this._element.placeholder=this.fallback;if(this.to=="value"){this._element.value=""}else{this._element[this.to]=this.fallback}return}this._element[this.to]=value};var __webservice_param_regex=new RegExp(/([\w_-]+)=(\??\$\w[\w_\d]+)/g);function __webservice_parameter(name,value){this.name=name;this.value=value;this.important=true;if(value.startsWith("$")){this.value=value.substr(1)}else{this.value=value.substr(2);this.important=false}}__webservice_parameter.prototype.getParameter=function(context){value=context[this.value];if(value==null){if(this.important){throw Error()}else{return this.name+"="}}return this.name+"="+encodeURI(value)};__webservice_parameter.prototype.toString=function(){return this.value};function __webservice_url(url){this._url=url;this._params=[];this._param_str="";params_pos=url.indexOf("?");if(params_pos!=-1){this._url=url.substr(0,params_pos);param_str=url.substr(params_pos+1);match=__webservice_param_regex.exec(param_str);if(match){params=[];pi=0;while(match){str=match[0];name=match[1];value=match[2];this._params.push(new __webservice_parameter(name,value));param_str=param_str.replace(str,"{"+pi+"}");pi++;__webservice_param_regex.lastIndex=0;match=__webservice_param_regex.exec(param_str)}this._param_str=param_str}else{}}}__webservice_url.prototype.getURL=function(context){try{url=this._url;if(this._param_str.length>0){url+="?";str=this._param_str;for(upi=0;upi<this._params.length;upi++){v=this._params[upi].getParameter(context);str=str.replace("{"+upi+"}",v)}url+=str}return url}catch(Error){return null}};__webservice_url.prototype.getParametersNames=function(){return this._params.join(",")};var xhr_timeout=4000;function WEBSERVICE_LOADING(msg){this.message=msg}function WEBSERVICE_ERROR(err){this.message=""+err}function WEBSERVICE_TIMEOUT(err){this.message=""+err}function __load_async_datas(url,context,prop,key){var xhr=new XMLHttpRequest();context[prop]=new WEBSERVICE_LOADING();context.notifyDatasetChanged(key,1);xhr.onload=function(e){if(xhr.status!==200){context[prop]=new WEBSERVICE_ERROR(xhr.responseText);context.notifyDatasetChanged(key,1);return}datas=xhr.response;if(datas==null){context[prop]=null;context.notifyDatasetChanged(key,1);return}type=xhr.getResponseHeader("content-type");if(type.startsWith("application/json")){try{datas=JSON.parse(datas)}catch(Error){datas=new WEBSERVICE_ERROR("Erreur lors du parse JSON")}}else{if(this.reader){datas=window[this.reader](datas)}}context[prop]=datas;context.notifyDatasetChanged(key,1)};xhr.onerror=function(err){context[prop]=new WEBSERVICE_ERROR(err);context.notifyDatasetChanged(key,1)};xhr.timeout=xhr_timeout;xhr.ontimeout=function(err){context[prop]=new WEBSERVICE_TIMEOUT(err);context.notifyDatasetChanged(key,1)};xhr.open("GET",url);xhr.send()}function __webservice_model_binding(infos){__model_binding.call(this,infos);this.reader=infos.reader;if(this.from.startsWith("http://")==true||this.from.startsWith("https://")==true){this._url=new __webservice_url(this.from);this.from=infos.as||generateUUID();this._prop_name="_"+this.from;var params=this._url.getParametersNames();if(params){if(this.alt==undefined){this.alt=params}else{this.alt+=","+params}}}}__webservice_model_binding.prototype=new __model_binding();__webservice_model_binding.prototype.init=function(context){if(this._url!=undefined){if(context[this._prop_name]==undefined){context[this._prop_name]=null;var prop_name=this._prop_name;Object.defineProperty(context,this.from,{get:function(){return this[prop_name]}})}}};__webservice_model_binding.prototype.populate=function(value,context,extra){if(extra){__model_binding.prototype.populate.call(this,value,context)}else{url=this._url.getURL(context);if(url){__load_async_datas(url,context,this._prop_name,this.from)}}};function notifyDatasetChanged(key,extra){if(key==null||key==""){var name=null,bds=null,b=null;for(key in BINDINGS){name=key.split(":")[1];bds=[];for(i=0;i<BINDINGS[key].length;i++){b=BINDINGS[key][i];if(b.from=="COMMANDS"||b.from==name){bds.push(b)}}__notifyDatasetChanged(CONTEXT,bds,key)}}else{CONTEXT.process_update=true;if(key in BINDINGS){__notifyDatasetChanged(CONTEXT,BINDINGS[key],key,extra)}CONTEXT.process_update=false}}function __notifyDatasetChanged(context,bindings,key,extra){var value=0,binding=null,v_key=null;for(var k in bindings){value=null;binding=bindings[k];if(key=="$this"||binding.from=="$this"){value=context}else{v_key=binding.from;if(context!=null&&v_key in context){value=context[v_key]}else{}}binding.populate(value,context,extra)}}var __verif_regex__=new RegExp(/[^\{]*(\{binding[^\}]+\})/g);var __regex__=new RegExp(/(?:\s+([\w_\-]+):((?:https?:\/\/[^ ]+)|(?:\$\w[\w_\d]+)|(?:'[^']+')|(?:\[[\$']?[\$'\w\s,\._;%\-]+(?:,[\$']?[\$'\w\s,\._;%\-]+)*\])|(?:[^\s\}]+)))/g);function __get_bindings(root,process_event,search){var evaluate=search||".//*[contains(text(),'{binding ') or @*[contains(.,'{binding ')]]";var binders=document.evaluate(evaluate,root,null,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);var elem=binders.iterateNext();var pg_bindings=[],bindings=null;while(elem!=null){bindings=__get_binding_from_attributes(elem,root,process_event);if(bindings==null||bindings.length==0){elem=binders.iterateNext();continue}__prepare_binding(bindings,process_event,pg_bindings);elem=binders.iterateNext()}bindings=__get_binding_from_attributes(root,root,process_event);if(bindings!=null&&bindings.length>0){__prepare_binding(bindings,process_event,pg_bindings)}return pg_bindings}function __prepare_binding(bindings,process_event,pg_bindings){var j=bindings.length,k=null,keys=null;while(j--){binding=bindings[j];k=binding.from==null?binding.command:binding.from;if(k==null){continue}if(process_event){keys=binding.getBindingKeys();var kk=keys.length;while(kk--){var key=keys[kk];key=CONTEXT.__uuid__+":"+key;if(key in pg_bindings){pg_bindings[key].push(binding)}else{pg_bindings[key]=[binding]}}}else{if(k in pg_bindings){pg_bindings[k].push(binding)}else{pg_bindings[k]=[binding]}}}}function __get_binding_from_attributes(elem,root,process_event){var bindings=[];var attrs=elem.attributes;var ij=attrs.length;while(ij--){attr=elem.attributes[ij];var bind=__parse_attribute(elem,root,attr.nodeName,attr.value,process_event);if(bind!=null){bindings.push(bind)}}var nodes=elem.childNodes;var result="";for(var i=0;i<nodes.length;i++){if(nodes[i].nodeType==3){result+=nodes[i].textContent}}result.trim();if(result!=""){var bind=__parse_attribute(elem,root,"innerHTML",result,process_event);if(bind!=null){bindings.push(bind)}}return bindings}function __parse_attribute(elem,root,nodeName,value,process_event){var cmds=value;if(cmds==null||cmds==""){return null}var match=__verif_regex__.exec(cmds);if(match==null){return null}cmds=match[1];var d_b=[];d_b["_element"]=elem;d_b["root"]=root;d_b["path"]=getDomPath(elem,root);var to=nodeName;if(to.indexOf("data-binded-")==0){to=to.split("-")[2]}d_b["to"]=to;var match_index=__verif_regex__.lastIndex-cmds.length;d_b["_index"]=match_index;d_b["_length"]=cmds.length;var match2=__regex__.exec(cmds);while(match2!=null){d_b[match2[1]]=match2[2];match2=__regex__.exec(cmds)}__regex__.lastIndex=0;__verif_regex__.lastIndex=0;if(d_b["from"]==null&&d_b["command"]==null){return null}d_b["process_event"]=process_event;var bind=d_b;if(process_event){bind=__create_binding_from_infos(d_b);bind.init(CONTEXT)}return bind}function __create_binding_from_infos(d_b){if(d_b["presenter"]!=null){d_b.to="innerHTML";if(d_b["from"].startsWith("http://")==true||d_b["from"].startsWith("https://")==true){return new __webservice_model_binding(d_b)}return new __model_binding(d_b)}if(d_b["item_presenter"]!=null){d_b.to="innerHTML";return new __array_binding(d_b)}if(d_b["command"]!=null){return new __command_binding(d_b)}if(d_b["mode"]=="2way"){if(d_b._element.localName=="input"){if(d_b._element.getAttribute("type")=="radio"&&d_b.to=="checked"){d_b.return_value=true;if(d_b.event==undefined){d_b.event="click"}if(d_b.converter==undefined){d_b.converter="ftw2:check_radio_value";d_b.converter_params="'"+d_b._element.value+"'"}}else{if(d_b._element.getAttribute("type")=="text"&&d_b._element.getAttribute("list")!=null){d_b.event="input"}}}return new __input_binding(d_b)}if(d_b.to=="innerHTML"){return new __textContent_binding(d_b)}if(d_b.forceAttr==null&&d_b.to in d_b._element){return new __prop_binding(d_b)}else{return new __attr_binding(d_b)}}function __unstringify(value){if(value!=null&&value[0]=="'"&&value[value.length-1]=="'"){value=value.substring(1,value.length-1)}return value}function AppInit(){ctx=document.body.getAttribute("data-context");if(ctx==null){throw"No context defined!"}CONTEXT=window[ctx];if(CONTEXT==null){throw"No context defined!"}defineBindObject(CONTEXT);CONTEXT["__process_update"]=false;Object.defineProperty(CONTEXT,"process_update",{get:function(){return this.__process_update},set:function(value){if(this.__process_update!=value){this.__process_update=value;key=this.__uuid__+":process_update";if(key in BINDINGS){__notifyDatasetChanged(this,BINDINGS[key],key)}}},enumerable:false});CONTEXT["__end_init"]=false;Object.defineProperty(CONTEXT,"end_init",{get:function(){return this.__end_init},set:function(value){if(this.__end_init!=value){this.__end_init=value;key=this.__uuid__+":end_init";if(key in BINDINGS){__notifyDatasetChanged(this,BINDINGS[key],key)}}},enumerable:false});var model_node=document.querySelector("body>div[data-role='presenters']");if(model_node!=null){model_node.style.display="none";models=model_node.querySelectorAll("body>div[data-role=presenters]>[data-role=presenter]");for(moi=0;moi<models.length;moi++){var model=models[moi];id=model.getAttribute("id");if(id==null||(model.children==null&&model.childNodes==null)){continue}children=model.children;if(children==null){children=[];end=model.childNodes.length;current=0;cn=model.childNodes;do{node=cn[current];if(node.nodeType!=8&&(node.nodeType!=3||/\S/.test(node.nodeValue))){children.push(node)}current++}while(current<end)}if(children.length==1){MODELS[id]=__get_bindings(children[0],false)}else{for(c_i=0;c_i<children.length;c_i++){mdl=children[c_i];dtype=mdl.getAttribute("data-type");if(dtype==null){MODELS[id]=__get_bindings(mdl,false)}else{MODELS[id+"_"+dtype]=__get_bindings(mdl,false)}}}}}BINDINGS=__get_bindings(document.body,true,"//*[not(ancestor::div[@data-role='presenters']) and (@*[contains(.,'{binding ')] or contains(text(),'{binding ')) ]");notifyDatasetChanged();CONTEXT.end_init=true}window.addEventListener("load",AppInit);FTW2=function(){};return FTW2}));